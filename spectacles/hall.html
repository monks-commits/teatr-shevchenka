<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Схема залу — Театр ім. Т. Г. Шевченка</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    .page-wrap{
      max-width:1100px;
      margin:0 auto;
      padding:20px 16px 40px;
      display:grid;
      grid-template-columns:minmax(0,1.6fr) minmax(0,1fr);
      gap:24px;
    }
    @media(max-width:900px){
      .page-wrap{
        grid-template-columns:1fr;
      }
    }

    .hall-scroll{
      background:#f3f4f6;
      border-radius:16px;
      padding:16px;
      overflow-x:auto;
      -webkit-overflow-scrolling:touch;
    }
    .hall-inner{
      width:max(780px,100%);
    }

    .hall-section{
      margin-bottom:18px;
    }
    .hall-section-title{
      text-align:center;
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:.05em;
      color:#6b7280;
      margin:6px 0 10px;
    }
    .hall-row{
      display:flex;
      align-items:flex-start;
      justify-content:center;
      gap:18px;
    }

    .hall-block{
      display:grid;
      gap:4px;
    }
    .hall-block--parter{
      grid-auto-rows:26px;
      grid-template-columns:repeat(20,26px);
    }
    .hall-block--amphi-left{
      grid-auto-rows:24px;
      grid-template-columns:repeat(11,24px);
    }
    .hall-block--amphi-right{
      grid-auto-rows:24px;
      grid-template-columns:repeat(11,24px);
    }
    .hall-block--balcony-half{
      grid-auto-rows:22px;
      grid-template-columns:repeat(14,22px);
    }
    .hall-block--balcony-last{
      grid-auto-rows:22px;
      grid-template-columns:repeat(10,22px);
    }
    .hall-lodge{
      display:flex;
      flex-direction:column;
      gap:4px;
      align-items:center;
      font-size:10px;
      color:#4b5563;
    }
    .hall-lodge-label{
      writing-mode:vertical-rl;
      text-orientation:mixed;
      font-size:11px;
      margin-bottom:4px;
    }

    .seat{
      width:100%;
      height:100%;
      border-radius:8px;
      border:1px solid #d1d5db;
      background:#ffffff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:11px;
      cursor:pointer;
      user-select:none;
    }
    .seat--parter-front{ background:#fef3c7; }   /* 1–6 */
    .seat--parter-mid{   background:#e0f2fe; }   /* 7–12 */
    .seat--parter-back{  background:#e5e7eb; }   /* 13–18 */
    .seat--amphi{        background:#e5e7eb; }
    .seat--balcony{      background:#e5e7eb; }
    .seat--lodge{        background:#e0f2fe; }

    .seat.selected{
      background:#2563eb;
      color:#fff;
      border-color:#2563eb;
    }
    .seat.taken{
      background:#9ca3af;
      color:#fff;
      cursor:not-allowed;
    }

    /* справа – боковая карточка заказа */
    .order-box{
      background:#fff;
      border-radius:16px;
      padding:16px 18px;
      box-shadow:0 10px 25px rgba(15,23,42,.06);
      border:1px solid #e5e7eb;
    }
    .order-title{
      font-size:18px;
      font-weight:700;
      margin:0 0 10px;
    }
    .order-meta{
      font-size:14px;
      color:#6b7280;
      margin:4px 0;
    }
    .order-list{
      margin:10px 0;
      font-size:14px;
    }
    .order-list li{
      margin-bottom:2px;
    }
    .order-total{
      margin-top:10px;
      font-weight:600;
    }
    .order-note{
      margin-top:10px;
      font-size:13px;
      color:#6b7280;
    }
    .btn-main{
      margin-top:14px;
      padding:10px 18px;
      border-radius:999px;
      border:none;
      background:#2563eb;
      color:#fff;
      font-weight:600;
      cursor:pointer;
    }
    .btn-main:disabled{
      background:#9ca3af;
      cursor:not-allowed;
    }
  </style>
</head>
<body>
<div id="site-header"></div>
<script type="module" src="/scripts/include.js"></script>

<main class="page-wrap">
  <!-- Зал -->
  <section>
    <h1 style="margin:0 0 12px;">Схема залу</h1>

    <div class="hall-scroll">
      <div class="hall-inner">
        <!-- Партер + ложі -->
        <div class="hall-section">
          <div class="hall-section-title">Партер</div>
          <div class="hall-row">
            <div class="hall-lodge" id="lodge-b">
              <div class="hall-lodge-label">Ложа Б</div>
            </div>

            <div id="parter" class="hall-block hall-block--parter"></div>

            <div class="hall-lodge" id="lodge-a">
              <div class="hall-lodge-label">Ложа А</div>
            </div>
          </div>
        </div>

        <!-- Амфітеатр -->
        <div class="hall-section">
          <div class="hall-section-title">Амфітеатр</div>
          <div class="hall-row">
            <div id="amphi-left" class="hall-block hall-block--amphi-left"></div>
            <div id="amphi-right" class="hall-block hall-block--amphi-right"></div>
          </div>
        </div>

        <!-- Балкон -->
        <div class="hall-section">
          <div class="hall-section-title">Балкон</div>
          <div class="hall-row">
            <div id="balcony-left" class="hall-block hall-block--balcony-half"></div>
            <div id="balcony-right" class="hall-block hall-block--balcony-half"></div>
          </div>
          <div class="hall-row" style="margin-top:6px;justify-content:center;">
            <!-- 6-й ряд балкона: 10 місць зліва + 10 справа -->
            <div id="balcony-row6-left"  class="hall-block hall-block--balcony-last"></div>
            <div style="width:30px;"></div>
            <div id="balcony-row6-right" class="hall-block hall-block--balcony-last"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Блок замовлення -->
  <aside class="order-box">
    <h2 class="order-title">Ваше замовлення</h2>
    <p id="order-show" class="order-meta">Вистава: —</p>
    <p id="order-date" class="order-meta"></p>
    <p id="order-picked" class="order-meta">Обрані місця: немає</p>

    <ul id="order-list" class="order-list"></ul>
    <p id="order-total" class="order-total">Сума: 0 грн</p>

    <p class="order-note">
      Натисніть на місця на схемі, щоб додати їх до замовлення.
      Після цього перейдіть до оформлення.
    </p>

    <button id="go-order" class="btn-main" disabled>Перейти до оформлення</button>
  </aside>
</main>

<div id="site-footer"></div>

<script>
  const urlParams = new URLSearchParams(location.search);
  const showSlug = urlParams.get("show") || "demo";

  // --- Конфігурація залу ---

  // Партер: 18 рядів по 20 місць
  const parterRows = Array.from({length:18}, (_,i)=>({
    row: i+1,
    seats: 20,
    zone: "Партер",
    // умовні ціни за секторами
    price: i+1 <= 6 ? 350 : (i+1 <= 12 ? 320 : 280),
    className: i+1 <= 6 ? "seat--parter-front"
              : i+1 <=12 ? "seat--parter-mid"
                         : "seat--parter-back"
  }));

  // Амфітеатр – ліва частина 19–23 (5 рядів по 11),
  // права частина 19–21 (3 ряди по 11)
  const amphiLeftRows  = [
    {row:19,seats:11},{row:20,seats:11},{row:21,seats:11},{row:22,seats:11},{row:23,seats:11}
  ].map(r=>({...r, zone:"Амфітеатр (ліва частина)", price:250, className:"seat--amphi"}));

  const amphiRightRows = [
    {row:19,seats:11},{row:20,seats:11},{row:21,seats:11}
  ].map(r=>({...r, zone:"Амфітеатр (права частина)", price:250, className:"seat--amphi"}));

  // Балкон: 1–5 — по 28 місць (14+прохід+14), 6-й — 10+10
  const balconyRows = [
    {row:1},{row:2},{row:3},{row:4},{row:5}
  ].map(r=>({...r, seatsPerSide:14, zone:"Балкон", price:200, className:"seat--balcony"}));

  const balconyRow6 = { row:6, seats:10, zone:"Балкон", price:180, className:"seat--balcony" };

  // Ложі А і Б — по 18 місць (вертикально)
  const lodgeSeats = Array.from({length:18}, (_,i)=>({
    index:i+1, price:350, zone:"Ложа", className:"seat--lodge"
  }));

  const selected = new Map(); // key -> seatData

  function makeSeatElement(key, label, extraClass, price, meta){
    const div = document.createElement("div");
    div.className = "seat " + (extraClass || "");
    div.textContent = label;
    div.dataset.key = key;
    div.dataset.price = price;
    div.dataset.meta = JSON.stringify(meta);

    div.addEventListener("click", () => {
      if (div.classList.contains("taken")) return;
      const k = div.dataset.key;
      if (selected.has(k)){
        selected.delete(k);
        div.classList.remove("selected");
      }else{
        selected.set(k, meta);
        div.classList.add("selected");
      }
      refreshOrderBox();
    });

    return div;
  }

  // рендер партеру
  (function renderParter(){
    const parterEl = document.getElementById("parter");
    parterRows.forEach(r=>{
      for(let s=1;s<=r.seats;s++){
        const key = `parter-${r.row}-${s}`;
        const label = s;
        const meta = {
          zone:r.zone,
          row:r.row,
          seat:s,
          price:r.price,
          human:`Партер, ряд ${r.row}, місце ${s}`
        };
        parterEl.appendChild(
          makeSeatElement(key,label,r.className,r.price,meta)
        );
      }
    });
  })();

  // рендер лож
  (function renderLodges(){
    const lodgeBEl = document.getElementById("lodge-b");
    const lodgeAEl = document.getElementById("lodge-a");

    lodgeSeats.forEach(ls=>{
      const metaB = {
        zone:"Ложа Б",
        row:ls.index,
        seat:1,
        price:ls.price,
        human:`Ложа Б, місце ${ls.index}`
      };
      lodgeBEl.appendChild(
        makeSeatElement(`lodge-b-${ls.index}`, ls.index, ls.className, ls.price, metaB)
      );

      const metaA = {
        zone:"Ложа А",
        row:ls.index,
        seat:1,
        price:ls.price,
        human:`Ложа А, місце ${ls.index}`
      };
      lodgeAEl.appendChild(
        makeSeatElement(`lodge-a-${ls.index}`, ls.index, ls.className, ls.price, metaA)
      );
    });
  })();

  // амфітеатр
  (function renderAmphi(){
    const leftEl  = document.getElementById("amphi-left");
    const rightEl = document.getElementById("amphi-right");

    amphiLeftRows.forEach(r=>{
      for(let s=1;s<=r.seats;s++){
        const key = `amphiL-${r.row}-${s}`;
        const meta = {
          zone:r.zone,
          row:r.row,
          seat:s,
          price:r.price,
          human:`Амфітеатр (ліва), ряд ${r.row}, місце ${s}`
        };
        leftEl.appendChild(
          makeSeatElement(key,s,r.className,r.price,meta)
        );
      }
    });

    amphiRightRows.forEach(r=>{
      for(let s=1;s<=r.seats;s++){
        const key = `amphiR-${r.row}-${s}`;
        const meta = {
          zone:r.zone,
          row:r.row,
          seat:s,
          price:r.price,
          human:`Амфітеатр (права), ряд ${r.row}, місце ${s}`
        };
        rightEl.appendChild(
          makeSeatElement(key,s,r.className,r.price,meta)
        );
      }
    });
  })();

  // балкон 1–5
  (function renderBalcony(){
    const leftEl  = document.getElementById("balcony-left");
    const rightEl = document.getElementById("balcony-right");

    balconyRows.forEach(r=>{
      // ліва половина
      for(let s=1;s<=r.seatsPerSide;s++){
        const key = `balL-${r.row}-${s}`;
        const meta = {
          zone:r.zone,
          row:r.row,
          seat:s,
          price:r.price,
          human:`Балкон, ряд ${r.row}, місце ${s}`
        };
        leftEl.appendChild(
          makeSeatElement(key,s,r.className,r.price,meta)
        );
      }
      // права половина
      for(let s=1;s<=r.seatsPerSide;s++){
        const num = s + r.seatsPerSide;
        const key = `balR-${r.row}-${num}`;
        const meta = {
          zone:r.zone,
          row:r.row,
          seat:num,
          price:r.price,
          human:`Балкон, ряд ${r.row}, місце ${num}`
        };
        rightEl.appendChild(
          makeSeatElement(key,num,r.className,r.price,meta)
        );
      }
    });

    // 6-й ряд
    const l6 = document.getElementById("balcony-row6-left");
    const r6 = document.getElementById("balcony-row6-right");
    for(let s=1;s<=balconyRow6.seats;s++){
      const key = `bal6L-${s}`;
      const meta = {
        zone:"Балкон",
        row:6,
        seat:s,
        price:balconyRow6.price,
        human:`Балкон, ряд 6, місце ${s}`
      };
      l6.appendChild(
        makeSeatElement(key,s,balconyRow6.className,balconyRow6.price,meta)
      );
    }
    for(let s=1;s<=balconyRow6.seats;s++){
      const num = s+10;
      const key = `bal6R-${num}`;
      const meta = {
        zone:"Балкон",
        row:6,
        seat:num,
        price:balconyRow6.price,
        human:`Балкон, ряд 6, місце ${num}`
      };
      r6.appendChild(
        makeSeatElement(key,num,balconyRow6.className,balconyRow6.price,meta)
      );
    }
  })();

  // заполняем шапку заказа (берём из /data/shows/<slug>.json если есть)
  (async function fillShowInfo(){
    const showEl = document.getElementById("order-show");
    const dateEl = document.getElementById("order-date");
    try{
      const r = await fetch(`/data/shows/${encodeURIComponent(showSlug)}.json`, {cache:"no-store"});
      if (!r.ok) { showEl.textContent = "Вистава: " + showSlug; return; }
      const s = await r.json();
      const title = s.title || showSlug;
      const when = [s.date,s.time].filter(Boolean).join(" • ");
      showEl.textContent = "Вистава: " + title;
      if (when) dateEl.textContent = when;
    }catch(e){
      showEl.textContent = "Вистава: " + showSlug;
    }
  })();

  const orderListEl  = document.getElementById("order-list");
  const orderPickedEl = document.getElementById("order-picked");
  const orderTotalEl = document.getElementById("order-total");
  const goOrderBtn   = document.getElementById("go-order");

  function refreshOrderBox(){
    const seats = Array.from(selected.values());
    if (!seats.length){
      orderPickedEl.textContent = "Обрані місця: немає";
      orderListEl.innerHTML = "";
      orderTotalEl.textContent = "Сума: 0 грн";
      goOrderBtn.disabled = true;
      return;
    }
    orderPickedEl.textContent = `Обрані місця: ${seats.length}`;
    orderListEl.innerHTML = seats
      .map(s=>`<li>${s.human} — ${s.price} грн</li>`)
      .join("");

    const total = seats.reduce((sum,s)=>sum+s.price,0);
    orderTotalEl.textContent = `Сума: ${total} грн`;
    goOrderBtn.disabled = false;
  }

  goOrderBtn.addEventListener("click", ()=>{
    const seats = Array.from(selected.values());
    if (!seats.length) return;
    const amount = seats.reduce((sum,s)=>sum+s.price,0);
    const seatsHuman = seats.map(s=>s.human).join("; ");

    const u = new URL(location.origin + "/order.html");
    u.searchParams.set("show", showSlug);
    u.searchParams.set("title", document.getElementById("order-show").textContent.replace("Вистава: ",""));
    u.searchParams.set("seats", seatsHuman);
    u.searchParams.set("amount", String(amount));

    location.href = u.toString();
  });
</script>
</body>
</html>
