<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Афіша — Театр ім. Т. Г. Шевченка</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .afisha-grid{
      display:grid;
      gap:16px;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      margin-top:20px;
    }
    .afisha-card{
      background:#fff;
      border-radius:12px;
      border:1px solid #e5e7eb;
      padding:12px;
      display:grid;
      gap:10px;
    }
    .afisha-poster{
      width:100%;
      height:260px;
      object-fit:cover;
      border-radius:10px;
      background:#e5e7eb;
    }
    .meta{color:#6b7280;font-size:14px;}
    .btn-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:6px;
    }
  </style>
</head>
<body>
  <div id="site-header"></div>
  <script type="module" src="scripts/include.js"></script>

  <main class="main">
    <section class="section">
      <div class="container">
        <h1>Афіша</h1>
        <p class="meta">Оберіть виставу та перейдіть до вибору місць у залі.</p>

        <div id="afisha-grid" class="afisha-grid"></div>
        <p id="afisha-empty" class="meta" style="display:none;margin-top:12px">
          Наразі немає запланованих подій.
        </p>
      </div>
    </section>
  </main>

  <div id="site-footer"></div>

  <script>
    (async () => {
      const grid = document.getElementById('afisha-grid');
      const emptyEl = document.getElementById('afisha-empty');

      let items = [];
      try {
        const res = await fetch('data/afisha.json', { cache: 'no-store' });
        items = res.ok ? await res.json() : [];
      } catch (e) {
        console.error(e);
        items = [];
      }

      if (!Array.isArray(items) || !items.length) {
        emptyEl.style.display = 'block';
        return;
      }

      function cardHTML(s) {
        const id = s.id || '';
        const poster = s.poster ? s.poster : '';
        const when = [s.date, s.time].filter(Boolean).join(' • ');
        const place = [s.theatre, s.stage].filter(Boolean).join(' • ');

        return `
          <article class="afisha-card">
            ${poster ? `
              <img
                src="${poster}"
                alt="${s.title || ''}"
                class="afisha-poster"
                onerror="this.style.display='none'"
              />
            ` : ''}

            <div>
              <strong>${s.title || ''}</strong>
            </div>

            ${when ? `<div class="meta">${when}</div>` : ''}
            ${place ? `<div class="meta">${place}</div>` : ''}

            <div class="btn-row">
              <a class="btn secondary" href="show.html?show=${encodeURIComponent(id)}">
                Детальніше
              </a>
              <a class="btn" href="spectacles/hall.html?show=${encodeURIComponent(id)}">
                Вибрати місця
              </a>
            </div>
          </article>
        `;
      }
 
      grid.innerHTML = items.map(cardHTML).join('');
    })();
  </script>
</body>
</html>
